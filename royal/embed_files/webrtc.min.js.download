!function(e,o){"object"==typeof exports&&"object"==typeof module?module.exports=o(require("Clappr")):"function"==typeof define&&define.amd?define(["Clappr"],o):"object"==typeof exports?exports.WebRTC=o(require("Clappr")):e.WebRTC=o(e.Clappr)}(this,function(e){return function(e){function o(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}var t={};return o.m=e,o.c=t,o.p="",o(0)}([function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=t(1),e.exports=o.default},function(e,o,t){"use strict";function n(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function i(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o)}Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function e(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(o,t,n){return t&&e(o.prototype,t),n&&e(o,n),o}}(),a=function(e,o,t){for(var n=!0;n;){var i=e,r=o,a=t;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,r);if(void 0!==s){if("value"in s)return s.value;var c=s.get;if(void 0===c)return;return c.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,o=r,t=a,n=!0,s=l=void 0}},s=t(2);navigator.getDisplayMedia=navigator.getDisplayMedia||navigator.mozGetDisplayMedia||navigator.webkitGetDisplayMedia,navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate,window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription;var c=function(e){function o(e){n(this,o),e.debug&&console.log("%cWebRTC constructor / options","color: #ff6c0c;",e),e.preload="",e.webrtcConfig=e.webrtcConfig||{},a(Object.getPrototypeOf(o.prototype),"constructor",this).call(this,e),e.htmlVideo=this,this.browserName="other";var t=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);if(!t&&navigator.userAgent.toLowerCase().indexOf("yabrowser")>-1?this.browserName="yandex":/iPhone|iPad|iPod/i.test(navigator.userAgent)?this.browserName="iphone":/Firefox/i.test(navigator.userAgent)&&(this.browserName="firefox"),this.streamInfo={applicationName:"tv",streamName:"myStream",sessionId:""},this.userData={param1:"value1"},!e.webrtcConfig||!e.webrtcConfig.streamName)throw new Error("webrtcConfig.streamName not undefined");this.streamInfo.streamName=this.options.webrtcConfig.streamName,this.streamInfo.applicationName=this.options.webrtcConfig.applicationName,this._initWebsocket(e)}return i(o,e),r(o,[{key:"attemptAutoPlay",value:function(){var e=this;this.options.debug&&console.log("%cWebRTC attemptAutoPlay","color: #ff6c0c;"),setTimeout(function(){e.play()},500)}},{key:"attributes",get:function(){return{"data-html5-video":"",id:this.options.cid}}}],[{key:"canPlay",value:function(e){arguments.length<=1||void 0===arguments[1]?"":arguments[1];return!0}}]),r(o,[{key:"stopListening",value:function(){a(Object.getPrototypeOf(o.prototype),"stopListening",this).call(this)}},{key:"_initWebsocket",value:function(e){var o=this;this.webSocketConnection=new WebSocket(e.webrtcConfig.wsUrl),this.webSocketConnection.binaryType="arraybuffer",this.webSocketConnection.onopen=function(t){e.debug&&console.log("%cWebRTC / webSocketConnection.onopen / -options -event -this","color: #ff6c0c;",e,t,o),e.htmlVideo.sendPlayGetOffer(),e.htmlVideo.peerConnection=new RTCPeerConnection({iceServers:[]}),e.htmlVideo.peerConnection.onicecandidate=function(o){e.debug&&console.log("%cWebRTC / peerConnection.onicecandidate / -event","color: #ff6c0c;",o)},e.htmlVideo.peerConnection.ontrack=function(o){e.debug&&console.log("%cWebRTC / onopen / ontrack / -event","color: #ff6c0c;",o),e.htmlVideo.el.srcObject=o.streams[0]}},this.webSocketConnection.onmessage=function(o){var t=o.data;"yandex"==e.htmlVideo.browserName&&(t=t.replace(/42\w/i,"420"));var n=JSON.parse(t),i=Number(n.status),r=n.command;if(e.debug&&console.log("%cWebRTC / onmessage / -event, -msgJSON","color: #ff6c0c;",o,n),514==i)e.debug&&console.log("%cWebRTC / onmessage / status: 514","color: #ff6c0c;");else if(200!=i)e.debug&&console.log("%cWebRTC / onmessage / status: NOT 200","color: #ff6c0c;");else{e.debug&&console.log("%cWebRTC / onmessage / status: 200","color: #ff6c0c;");var a=n.streamInfo;void 0!==a&&(e.htmlVideo.streamInfo.sessionId=a.sessionId);var s=n.sdp;void 0!==s&&e.htmlVideo.peerConnection.setRemoteDescription(new RTCSessionDescription(n.sdp),function(){e.htmlVideo.peerConnection.createAnswer(function(o){e.debug&&console.log("%cWebRTC / peerConnection.createAnswer / -description","color: #ff6c0c;",o),e.htmlVideo.peerConnection.setLocalDescription(o,function(){e.debug&&console.log("%cWebRTC / peerConnection.setLocalDescription / -streamInfo -description","color: #ff6c0c;",e.htmlVideo.streamInfo,o),e.htmlVideo.webSocketConnection.send('{"direction":"play", "command":"sendResponse", "streamInfo":'+JSON.stringify(e.htmlVideo.streamInfo)+', "sdp":'+JSON.stringify(o)+', "userData":'+JSON.stringify(e.htmlVideo.userData)+"}")},function(){e.debug&&console.log("set description error")})},e.htmlVideo.errorHandler)},e.htmlVideo.errorHandler);var c=n.iceCandidates;if(void 0!==c){e.debug&&console.log("iceCandidates: ",c);for(var l in c)"firefox"==e.htmlVideo.browserName&&JSON.stringify(c[l]).indexOf("TCP")>=0||"firefox"!=e.htmlVideo.browserName&&JSON.stringify(c[l]).indexOf("UDP")>=0||e.htmlVideo.peerConnection.addIceCandidate(new RTCIceCandidate(c[l]),function(){e.debug&&console.log("addIceCandidate success")},function(){e.debug&&console.log("addIceCandidate error")})}}if(0=="sendResponse".localeCompare(r)&&(null!=e.htmlVideo.webSocketConnection&&e.htmlVideo.webSocketConnection.close(),e.htmlVideo.webSocketConnection=null),0=="getAvailableStreams".localeCompare(r)){var d=n.availableStreams;if(e.debug&&console.log("availableStreams",d),void 0!==d)for(var f in d)0===d[f].streamName.indexOf(e.htmlVideo.streamInfo.streamName)&&(e.htmlVideo.streamInfo.streamName=d[f].streamName)}},this.webSocketConnection.onclose=function(){o.options.debug&&console.log("webSocketConnection.onclose")},this.webSocketConnection.onerror=function(e){o.options.debug&&console.log("webSocketConnection.onerror",e)}}},{key:"sendPlayGetAvailableStreams",value:function(){this.webSocketConnection.send('{"direction":"play", "command":"getAvailableStreams", "streamInfo":'+JSON.stringify(this.streamInfo)+', "userData":'+JSON.stringify(this.userData)+"}")}},{key:"sendPlayGetOffer",value:function(){this.webSocketConnection.send('{"direction":"play", "command":"getOffer", "streamInfo":'+JSON.stringify(this.streamInfo)+', "userData":'+JSON.stringify(this.userData)+"}")}},{key:"errorHandler",value:function(e){console.log("errorHandler",e)}},{key:"play",value:function(){this.options.debug&&console.log("%cWebRTC / play() / -this","color:#ff6c0c;",this),this.options.htmlVideo.el.play()}}]),o}(s.HTML5Video);o.default=c,c.debug=function(e){return console.log(e)},e.exports=o.default},function(o,t){o.exports=e}])});
//# sourceMappingURL=webrtc.min.js.map